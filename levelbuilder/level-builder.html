<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Level Builder</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        canvas {
            border: 1px solid black;
            background-color: #f0f0f0;
            margin-top: 20px;
        }
        .controls {
            margin: 10px;
        }
        #propertyWindow {
            display: none;
            border: 1px solid #000;
            padding: 10px;
            margin-top: 20px;
            background-color: #fff;
        }
    </style>
</head>
<body>
    <h1>Level Builder</h1>
    <div class="controls">
        <label for="spawnX">Spawn X: </label>
        <input type="number" id="spawnX" value="100">
        <label for="spawnY">Spawn Y: </label>
        <input type="number" id="spawnY" value="220">
        <button id="addPlatform">Plattform hinzufügen</button>
        <button id="exportJSON">Exportiere JSON</button>
        <input type="file" id="importJSON" accept=".json">
    </div>
    <canvas id="levelCanvas" width="1000" height="400"></canvas>
    <div id="propertyWindow">
        <h2>Plattform Eigenschaften</h2>
        <label for="platformX">X: </label>
        <input type="number" id="platformX" value="0">
        <br>
        <label for="platformY">Y: </label>
        <input type="number" id="platformY" value="0">
        <br>
        <label for="platformWidth">Breite: </label>
        <input type="number" id="platformWidth" value="100">
        <br>
        <label for="platformHeight">Höhe: </label>
        <input type="number" id="platformHeight" value="20">
        <br>
        <button id="deletePlatform">Plattform löschen</button>
    </div>

    <script>
        const canvas = document.getElementById('levelCanvas');
        const ctx = canvas.getContext('2d');

        let platforms = [];
        let spawn = { x: 100, y: 220 };
        let selectedPlatform = null;
        let isDragging = false;

        let camera = { x: 0, y: 0, zoom: 1 }; // Kamera für Panning und Zoom

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.save();
            ctx.translate(camera.x, camera.y); // Panning
            ctx.scale(camera.zoom, camera.zoom); // Zoom

            ctx.fillStyle = '#FF4500'; // Lava zeichnen
            ctx.fillRect(0, canvas.height - 30, canvas.width, 30);
            ctx.fillStyle = '#0000FF'; // Plattformfarbe
            for (let platform of platforms) {
                ctx.fillRect(platform.x, platform.y, platform.width, platform.height);
            }
            ctx.fillStyle = '#00FF00'; // Spawnpunkt zeichnen
            ctx.fillRect(spawn.x, spawn.y, 10, 10);

            ctx.restore();
        }

        function updatePropertyWindow(platform) {
            document.getElementById('propertyWindow').style.display = 'block';
            document.getElementById('platformX').value = platform.x;
            document.getElementById('platformY').value = platform.y;
            document.getElementById('platformWidth').value = platform.width;
            document.getElementById('platformHeight').value = platform.height;
            selectedPlatform = platform;
        }

        canvas.addEventListener('mousedown', (e) => {
            const mouseX = (e.offsetX - camera.x) / camera.zoom;
            const mouseY = (e.offsetY - camera.y) / camera.zoom;

            for (let platform of platforms) {
                if (
                    mouseX >= platform.x &&
                    mouseX <= platform.x + platform.width &&
                    mouseY >= platform.y &&
                    mouseY <= platform.y + platform.height
                ) {
                    isDragging = true;
                    updatePropertyWindow(platform);
                    break;
                }
            }
        });

        canvas.addEventListener('mouseup', () => {
            isDragging = false;
        });

        canvas.addEventListener('mousemove', (e) => {
            if (isDragging && selectedPlatform) {
                const mouseX = (e.offsetX - camera.x) / camera.zoom;
                const mouseY = (e.offsetY - camera.y) / camera.zoom;

                selectedPlatform.x = mouseX - selectedPlatform.width / 2;
                selectedPlatform.y = mouseY - selectedPlatform.height / 2;

                draw();
                updatePropertyWindow(selectedPlatform);
            }
        });

        document.getElementById('platformX').addEventListener('input', (e) => {
            if (selectedPlatform) {
                selectedPlatform.x = parseInt(e.target.value);
                draw();
            }
        });

        document.getElementById('platformY').addEventListener('input', (e) => {
            if (selectedPlatform) {
                selectedPlatform.y = parseInt(e.target.value);
                draw();
            }
        });

        document.getElementById('platformWidth').addEventListener('input', (e) => {
            if (selectedPlatform) {
                selectedPlatform.width = parseInt(e.target.value);
                draw();
            }
        });

        document.getElementById('platformHeight').addEventListener('input', (e) => {
            if (selectedPlatform) {
                selectedPlatform.height = parseInt(e.target.value);
                draw();
            }
        });

        document.getElementById('deletePlatform').addEventListener('click', () => {
            if (selectedPlatform) {
                platforms = platforms.filter(p => p !== selectedPlatform);
                selectedPlatform = null;
                document.getElementById('propertyWindow').style.display = 'none';
                draw();
            }
        });

        document.getElementById('exportJSON').addEventListener('click', () => {
            const levelData = {
                spawn: spawn,
                platforms: platforms
            };
            const json = JSON.stringify(levelData, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'level.json';
            a.click();
            URL.revokeObjectURL(url);
        });

        document.getElementById('importJSON').addEventListener('change', (e) => {
            const file = e.target.files[0];
            const reader = new FileReader();
            reader.onload = (event) => {
                const levelData = JSON.parse(event.target.result);
                spawn = levelData.spawn;
                platforms = levelData.platforms;
                draw();
            };
            reader.readAsText(file);
        });

        document.getElementById('spawnX').addEventListener('input', (e) => {
            spawn.x = parseInt(e.target.value);
            draw();
        });

        document.getElementById('spawnY').addEventListener('input', (e) => {
            spawn.y = parseInt(e.target.value);
            draw();
        });

        document.getElementById('addPlatform').addEventListener('click', () => {
            const x = Math.floor(Math.random() * (canvas.width - 100));
            const y = Math.floor(Math.random() * (canvas.height - 60)) + 30; // 30 für die Lava
            const width = Math.floor(Math.random() * 150) + 50; // Breite zwischen 50 und 200
            const height = 20; // Höhe konstant

            const newPlatform = { x, y, width, height };
            platforms.push(newPlatform);
            draw();
        });

        // Zoom und Panning-Logik
        canvas.addEventListener('wheel', (e) => {
            e.preventDefault();
            const zoomFactor = 0.1;
            if (e.deltaY < 0) {
                camera.zoom = Math.min(camera.zoom + zoomFactor, 5); // Maximal zoom 5x
            } else {
                camera.zoom = Math.max(camera.zoom - zoomFactor, 0.5); // Minimal zoom 0.5x
            }
            draw();
        });

        let isPanning = false;
        let startX, startY;

        canvas.addEventListener('mousedown', (e) => {
            if (e.button === 1) { // Mittlere Maustaste für Panning
                isPanning = true;
                startX = e.offsetX - camera.x;
                startY = e.offsetY - camera.y;
            }
        });

        canvas.addEventListener('mousemove', (e) => {
            if (isPanning) {
                camera.x = e.offsetX - startX;
                camera.y = e.offsetY - startY;
                draw();
            }
        });

        canvas.addEventListener('mouseup', () => {
            isPanning = false;
        });

        draw();
    </script>
</body>
</html>
